/*
 Copyright (c)2006-2018 Nicholas K. Dionysopoulos / Akeeba Ltd
 @license   GNU General Public License version 3, or later
*/
if("undefined"==typeof akeeba)var akeeba={};"undefined"==typeof akeeba.Multidb&&(akeeba.Multidb={loadingGif:"",modalDialog:null});akeeba.Multidb.render=function(e){var b=document.getElementById("ak_list_contents");b.innerHTML="";for(rootname in e)e.hasOwnProperty(rootname)&&akeeba.Multidb.addRow(rootname,e[rootname],b);akeeba.Multidb.addNewRecordButton(b)};
akeeba.Multidb.addRow=function(e,b,n){var h=document.createElement("tr");h.className="ak_filter_row";akeeba.System.data.set(h,"root",e);akeeba.System.data.set(h,"def",JSON.stringify(b));var l=document.createElement("td");l.style.width="2em";var k=document.createElement("span");k.className="ak_filter_tab_icon_container akeeba-btn--red--mini";akeeba.System.addEventListener(k,"click",function(){var e={root:akeeba.System.data.get(this.parentNode.parentNode,"root"),verb:"remove"};akeeba.Fsfilters.toggle(e,
this,function(e,b){if(!0==e.success){var f=b.parentNode.parentNode;f.parentNode.removeChild(f)}})});var c=document.createElement("span");c.className="ak-toggle-button deletebutton";c.insertAdjacentHTML("beforeend",'<span class="akion-trash-a"></span>');k.appendChild(c);l.appendChild(k);k=document.createElement("td");k.style.width="2em";c=document.createElement("span");c.className="ak_filter_tab_icon_container akeeba-btn--teal--mini";akeeba.System.addEventListener(c,"click",function(){var b=this.parentNode.parentNode,
d=JSON.parse(akeeba.System.data.get(b,"def","{}"));akeeba.System.data.get(b,"root");var c=document.getElementById("akEditorDialog");""==d.driver&&(d.driver="mysqli");document.getElementById("ake_driver").value=d.driver;document.getElementById("ake_host").value=d.host;document.getElementById("ake_username").value=d.username;document.getElementById("ake_password").value=d.password;document.getElementById("ake_database").value=d.database;document.getElementById("ake_prefix").value=d.prefix;try{var f=
document.getElementById("ak_editor_notifier");f.parentNode.removeChild(f)}catch(g){}d=document.getElementById("akEditorBtnDefault");f=d.cloneNode(!0);d.parentNode.replaceChild(f,d);akeeba.System.addEventListener(f,"click",function(){try{var a=document.getElementById("ak_editor_notifier");a.parentNode.removeChild(a)}catch(b){}a=document.createElement("div");a.className="akeeba-block--info";a.id="ak_editor_notifier";var d=document.createElement("p");d.id="ak_editor_notifier_content";a.appendChild(d);
var c=document.createElement("img");c.setAttribute("border",0);c.setAttribute("src",akeeba.Multidb.loadingGif);d.appendChild(c);c=document.createElement("span");c.textContent=Joomla.JText._("COM_AKEEBA_MULTIDB_GUI_LBL_LOADING");d.appendChild(c);document.getElementById("ak_editor_table").insertAdjacentHTML("beforebegin",a.outerHTML);a=document.getElementById("ake_driver");a=a.options[a.selectedIndex];a=null==a?"":a.value;a={verb:"test",root:e,data:{host:document.getElementById("ake_host").value,driver:a,
port:document.getElementById("ake_port").value,user:document.getElementById("ake_username").value,password:document.getElementById("ake_password").value,database:document.getElementById("ake_database").value,prefix:document.getElementById("ake_prefix").value}};a={action:JSON.stringify(a)};akeeba.System.doAjax(a,function(a){var b=document.getElementById("ak_editor_notifier_content");!0==a.status?(document.getElementById("ak_editor_notifier").className="akeeba-block--success",b.textContent=Joomla.JText._("COM_AKEEBA_MULTIDB_GUI_LBL_CONNECTOK")):
(document.getElementById("ak_editor_notifier").className="akeeba-block--failure",b.innerHTML=Joomla.JText._("COM_AKEEBA_MULTIDB_GUI_LBL_CONNECTFAIL")+"<br/><code>"+a.message+"</code>")},function(a){var b=document.getElementById("ak_editor_notifier_content");document.getElementById("ak_editor_notifier").className="akeeba-block--failure";b.textContent=Joomla.JText._("COM_AKEEBA_MULTIDB_GUI_LBL_CONNECTFAIL");"object"==typeof akeeba.Multidb.modalDialog&&akeeba.Multidb.modalDialog.close&&akeeba.Multidb.modalDialog.close();
akeeba.System.params.errorCallback(a)},!1,15E3)});d=document.getElementById("akEditorBtnSave");f=d.cloneNode(!0);d.parentNode.replaceChild(f,d);akeeba.System.addEventListener(f,"click",function(){try{var a=document.getElementById("ak_editor_notifier");a.parentNode.removeChild(a)}catch(d){}a=document.createElement("div");a.className="akeeba-block--info";a.id="ak_editor_notifier";var c=document.createElement("p");c.id="ak_editor_notifier_content";a.appendChild(c);var f=document.createElement("img");
f.setAttribute("border",0);f.setAttribute("src",akeeba.Multidb.loadingGif);c.appendChild(f);f=document.createElement("span");f.textContent=Joomla.JText._("COM_AKEEBA_MULTIDB_GUI_LBL_LOADING");c.appendChild(f);document.getElementById("ak_editor_table").insertAdjacentHTML("beforebegin",a.outerHTML);var a=document.getElementById("ake_driver"),a=a.options[a.selectedIndex],a=null==a?"":a.value,g={verb:"set",root:e,data:{host:document.getElementById("ake_host").value,driver:a,port:document.getElementById("ake_port").value,
username:document.getElementById("ake_username").value,password:document.getElementById("ake_password").value,database:document.getElementById("ake_database").value,prefix:document.getElementById("ake_prefix").value,dumpFile:String(e).substr(0,9)+document.getElementById("ake_database").value+".sql"}},a={action:JSON.stringify(g)};akeeba.System.doAjax(a,function(a){!0!=a?document.getElementById("ak_editor_notifier_content").textContent=Joomla.JText._("COM_AKEEBA_MULTIDB_GUI_LBL_SAVEFAIL"):(akeeba.System.data.set(b,
"def",JSON.stringify(g.data)),b.querySelectorAll("td"),b.querySelector("span.ak_dbhost").textContent=g.data.host,b.querySelector("span.ak_dbname").textContent=g.data.database,-1==b.querySelector("span.editbutton").firstChild.className.indexOf("akion-edit")&&(b.querySelector("span.deletebutton").parentNode.style.display="inline-block",b.querySelector("span.editbutton").firstChild.className="akion-edit",akeeba.Multidb.addNewRecordButton(b.parentNode)),"object"==typeof akeeba.Multidb.modalDialog&&akeeba.Multidb.modalDialog.close&&
akeeba.Multidb.modalDialog.close())},function(a){document.getElementById("ak_editor_notifier_content").textContent=Joomla.JText._("COM_AKEEBA_MULTIDB_GUI_LBL_SAVEFAIL");"object"==typeof akeeba.Multidb.modalDialog&&akeeba.Multidb.modalDialog.close&&akeeba.Multidb.modalDialog.close();akeeba.System.params.errorCallback(a)},!1,15E3)});d=document.getElementById("akEditorBtnCancel");f=d.cloneNode(!0);d.parentNode.replaceChild(f,d);akeeba.System.addEventListener(f,"click",function(){"object"==typeof akeeba.Multidb.modalDialog&&
akeeba.Multidb.modalDialog.close&&akeeba.Multidb.modalDialog.close()});akeeba.Multidb.modalDialog=akeeba.Modal.open({inherit:c,width:"80%"});akeeba.System.triggerEvent(c.querySelector("span"),"focus")});var g=document.createElement("span");g.className="editbutton ak-toggle-button";g.insertAdjacentHTML("beforeend",'<span class="akion-edit"></span>');c.appendChild(g);k.appendChild(c);c=document.createElement("td");c.className="ak_filter_item";g=document.createElement("span");g.className="ak_filter_name ak_dbhost";
g.textContent=b.host;c.appendChild(g);g=document.createElement("td");g.className="ak_filter_item";var m=document.createElement("span");m.className="ak_filter_name ak_dbname";m.textContent=b.database;g.appendChild(m);h.appendChild(l);h.appendChild(k);h.appendChild(c);h.appendChild(g);n.appendChild(h)};
akeeba.Multidb.addNewRecordButton=function(e){var b=Math.uuid();akeeba.Multidb.addRow(b,{host:"",port:"",username:"",password:"",database:"",prefix:""},e);e=document.getElementById("ak_list_contents").children;e=e[e.length-1].querySelectorAll("td");e[0].querySelector("span").style.display="none";e=e[1].querySelectorAll("span");b=e[e.length-1];console.log(e,b);b.className="akion-plus"}; //# sourceMappingURL=MultipleDatabases.min.map
